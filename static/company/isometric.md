# Isometric 좌표계 정의서

## 1. 개요

이 프로젝트는 **2:1 아이소메트릭 투영(Isometric Projection)**을 사용합니다.
- 타일 너비(TILE_W): 64px
- 타일 높이(TILE_H): 32px
- 비율: 2:1

## 2. 좌표계 방향

```
                    (0,0)
                      ◆
                    ╱   ╲
        gx 증가   ╱       ╲   gy 증가
        (우하단) ╱         ╲ (좌하단)
               ↘           ↙
              ◆             ◆
           (1,0)           (0,1)
               ↘           ↙
                 ╲       ╱
                   ╲   ╱
                     ◆
                   (1,1)
```

### 방향 요약

| 축 | 증가 방향 | 화면상 방향 |
|---|---------|-----------|
| **gx** | gx++ | **우측 하단** ↘ |
| **gy** | gy++ | **좌측 하단** ↙ |

### 예시
- `(0,0)` → 화면 최상단 꼭지점
- `(WIDTH-1, 0)` → 우측 모서리
- `(0, HEIGHT-1)` → 좌측 모서리
- `(WIDTH-1, HEIGHT-1)` → 최하단 꼭지점

## 3. 좌표 변환 공식

### Grid → Screen (그리드 좌표 → 화면 픽셀)

```javascript
screenX = (gx - gy) * (TILE_W / 2)
screenY = (gx + gy) * (TILE_H / 2)
```

### Screen → Grid (화면 픽셀 → 그리드 좌표)

```javascript
gx = (screenX / (TILE_W / 2) + screenY / (TILE_H / 2)) / 2
gy = (screenY / (TILE_H / 2) - screenX / (TILE_W / 2)) / 2
```

## 4. 타일 다이아몬드 꼭지점

각 타일은 다이아몬드(마름모) 형태이며, 4개의 꼭지점을 가집니다:

```
           top (0, -16)
              ◆
            ╱   ╲
          ╱       ╲
left    ◆           ◆   right
(-32,0)   ╲       ╱     (+32,0)
            ╲   ╱
              ◆
         bottom (0, +16)
```

| 꼭지점 | 상대 좌표 (center 기준) |
|-------|----------------------|
| top | (0, -TILE_H/2) = (0, -16) |
| right | (+TILE_W/2, 0) = (+32, 0) |
| bottom | (0, +TILE_H/2) = (0, +16) |
| left | (-TILE_W/2, 0) = (-32, 0) |

## 5. 깊이 정렬 (Depth Sorting)

아이소메트릭에서는 뒤에 있는 객체가 먼저 그려져야 합니다.

```javascript
depthKey = (gx + gy) * 100 + layer
```

- `gx + gy` 값이 작을수록 화면 뒤쪽 (먼저 그림)
- `gx + gy` 값이 클수록 화면 앞쪽 (나중에 그림)
- `layer`는 같은 타일 위치에서의 추가 정렬용

## 6. 방(Room) 레이아웃 예시

```
ROOM.WIDTH = 12   (gx: 0~11)
ROOM.HEIGHT = 10  (gy: 0~9)
```

```
              gx=0  gx=1  gx=2  ...  gx=11
                ◆────◆────◆─────────◆
               ╱ ╲  ╱ ╲  ╱ ╲       ╱ ╲
        gy=0  ◆   ◆◆   ◆◆   ◆ ... ◆   ◆  ← 뒷벽
              │╲ ╱│╲ ╱│╲ ╱       │╲ ╱│
        gy=1  ◆──◆◆──◆◆──◆ ...   ◆──◆
              │╲ ╱│              │╲ ╱│
        ...   ...                ...
              │╲ ╱│              │╲ ╱│
        gy=9  ◆──◆◆──◆ ...       ◆──◆  ← 앞쪽
              ↑                      ↑
           좌측벽                우측 끝
           (gx=0)              (gx=11)
```

## 7. 카펫/바닥 영역 수정 가이드

### 현재 바닥 코드 구조

```javascript
// 전체 바닥 타일
for (let gy = 0; gy < HEIGHT; gy++) {
    for (let gx = 0; gx < WIDTH; gx++) {
        // 하얀색 타일 그리기
    }
}

// 카펫 영역 (파란색)
for (let gy = 1; gy < 8; gy++) {        // 좌하단 방향: gy 범위
    for (let gx = 1; gx < WIDTH - 2; gx++) {  // 우하단 방향: gx 범위
        // 파란색 카펫 그리기
    }
}
```

### 영역 조정 방법

| 원하는 변경 | 수정할 값 |
|-----------|----------|
| **우하단** 줄이기/늘리기 | `gx < WIDTH - N` 의 N값 조정 |
| **좌하단** 줄이기/늘리기 | `gy < M` 의 M값 조정 |
| **좌상단** 늘리기 | `gy = 1` 시작값 조정 |
| **우상단** 늘리기 | `gx = 1` 시작값 조정 |

## 8. 가구 크기 정의

가구 크기는 **W x H** 형식으로 표기합니다:
- **W** = gx 방향 타일 수 (↘ 우하단)
- **H** = gy 방향 타일 수 (↙ 좌하단)

### 예시: 5x3 테이블

```
                  (0,0)
                    ◆ ← 테이블 시작점
                  ↗   ↘
               ↗         ↘  W=5 (gx 방향 ↘)
            ↗               ↘
         ◆─────────────────────◆ (5,0)
       ↙ │                     │
      ↙  │                     │
    ↙    │     5x3 테이블      │  H=3 (gy 방향 ↙)
  ◆      │                     │
(0,3)    └─────────────────────◆ (5,3)
```

### 코드에서의 정의

```javascript
const TABLE_CONFIG = {
    gridWidth: 5,   // W = gx 방향 (↘ 우하단)
    gridHeight: 3,  // H = gy 방향 (↙ 좌하단)
};
```

## 9. 주의사항

1. **화면 좌표와 그리드 좌표 혼동 금지**
   - 화면에서 "오른쪽"은 gx 증가 또는 gy 감소
   - 화면에서 "왼쪽"은 gy 증가 또는 gx 감소

2. **아이소메트릭 방향 암기법**
   ```
   gx++ = ↘ (우하단으로)
   gy++ = ↙ (좌하단으로)
   ```

3. **디버깅 팁**
   - 특정 타일 위치 확인 시 `ISO.gridToScreen(gx, gy)`로 화면 좌표 계산
   - 클릭 위치에서 그리드 좌표 확인 시 `ISO.screenToGrid(screenX, screenY)` 사용
